import pandas as pd                     # for working with dataframes



CVE_reporter_name = "vulnerability-report-kaptain-main.csv"
grype_report_name = "vulnerability-report-kaptain-2022-06-18.csv"
final_report_name = "grype-missing-CVEs.csv"

CVE_reporter_df = pd.read_csv(CVE_reporter_name)
grype_report_df = pd.read_csv(grype_report_name)

# 1. discover how many critical CVEs are present in CVE reporter and absent in grype
# 1.1 only keep the columns we will need
CVE_reporter_df = CVE_reporter_df[['resource_purl', 'vulnerability_name']].drop_duplicates()
grype_report_df = grype_report_df[['resource_purl', 'vulnerability.id']].drop_duplicates()

# 1.2 do a left merge with indicator, with CVE reporter on the left
results_df = pd.merge(
    CVE_reporter_df, 
    grype_report_df, 
    how='left', 
    left_on=['resource_purl', 'vulnerability_name'],
    right_on=['resource_purl', 'vulnerability.id'],
    suffixes=(False, False),
    indicator=True)

# 1.3 filter the results based on indicator column
results_df = results_df[results_df['_merge'] == 'left_only'][['resource_purl', 'vulnerability_name']]

# 1.4 save results to acsv
results_df.to_csv(final_report_name, index=False)